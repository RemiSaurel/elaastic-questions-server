<!--
  ~ Elaastic - formative assessment system
  ~ Copyright (C) 2019. University Toulouse 1 Capitole, University Toulouse 3 Paul Sabatier
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->
<div th:fragment="evaluationPhase(model)"
     th:remove="tag"
     xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
  <div class="ui segment">
    <div class="ui dividing header" th:text="#{sequence.phase.Evaluation.description}">
      Comparing viewpoints
    </div>

    <style>

        .ui.pagination.menu .active.item {
            background-color: #dff0ff;
            color: #0e6eb8;
        }
    </style>

    <form th:unless="${model.userHasCompletedPhase2 || model.phaseState.name() == 'afterStop'}"
          th:action="@{/player/sequence/{sequenceId}/phase/evaluation/one-by-one/submit-evaluation(sequenceId=${model.sequenceId})}"
          class="ui form"
          method="post">
      <input type="hidden" name="interactionId" th:value="${model.interactionId}"/>
      <th:block th:if="${model.nextResponseToGrade}">
        <div class="ui blue message" th:text="#{player.sequence.interaction.evaluation.oneByOne.intro}">
          Here is presented an alternative response. Please indicate how much you agree with this answer.
        </div>


        <div
          th:replace="player/assignment/sequence/components/response/_response::response(${model.choices}, ${model.nextResponseToGrade.choiceList}, ${model.nextResponseToGrade.explanation})"></div>

        <div class="ui hidden divider"></div>

        <h4 class="ui header" th:text="#{player.sequence.interaction.your.evaluation}">Your evaluation</h4>
        <div id="phase2-evaluation-app">
          <input type="hidden" name="responseId" th:value="${model.nextResponseToGrade.id}"/>
          <likert-scale-input th:attr="current-response-id=${model.nextResponseToGrade.id}"
                              value="-1"
                              @change-grade="onChangeGrade"></likert-scale-input>
        </div>

        <div class="ui hidden divider"></div>

      </th:block>

      <script>
        function onChangeGrade () {
          // Just do nothing by default...
        }

        function onSubmitResponse () {
          // Just do nothing by default...
        }
      </script>

      <th:block th:if="${model.secondAttemptAllowed && model.nextResponseToGrade != null}">
        <div th:replace="player/assignment/sequence/phase/evaluation/_change-answer-form::changeAnswerForm(${model.secondAttemptAlreadySubmitted}, ${model.responseFormModel}, ${model.lastResponseToGrade})"></div>

        <script>
          function onChangeGrade (grade) {
            if (grade > 0) {
              $('#change-answer-section').show()
            } else {
              $('#change-answer-section').hide()
            }
          }
        </script>
      </th:block>

      <th:block th:if="${!model.userHasCompletedPhase2}">
        <div class="ui hidden divider"></div>

        <div class="ui basic segment">
          <input type="submit"
                 class="ui primary button"
                 onclick="onSubmitResponse()"
                 th:value="#{player.sequence.interaction.submitResponse}"/>
        </div>
      </th:block>

    </form>

    <div th:if="${model.userHasCompletedPhase2}"
         class="ui blue message"
         th:text="#{player.sequence.phase.completedByUser(${2})}">
    </div>

    <div th:if="${!model.userHasCompletedPhase2 && model.phaseState.name() == 'afterStop'}"
         class="ui blue message"
         th:text="#{player.sequence.interaction.evaluation.tooLate}">
    </div>


  </div>

  <div th:replace="player/assignment/sequence/phase/evaluation/method/likert/_likert_scale_input"></div>

</div>