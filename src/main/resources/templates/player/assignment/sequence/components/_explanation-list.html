<!-- TODO <g:set var="explanationCount" value="${responses.collect { it?.explanation ? 1 : 0 }.sum()}"/> -->
<div th:fragment="explanationList(responses, displaysAll, explanationCount)"
     style="font-size: 1rem"
     xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
  <div th:if="${displaysAll }" th:remove="tag">

    <div th:each="response, i : ${responses}" th:with="explanation=${response.explanation}">
      <div th:if="${explanation}">
        Il y a une explication l√† :-)
        <!--          TODO Migrate render-->
        <!--          <g:render template="/assignment/player/explanation-elaastic"-->
        <!--                    model="[theResponse: response, explanation: explanation]"/>-->
      </div>
    </div>
    <div th:if="${explanationCount == 0}" class="ui warning message"
         th:text="#{player.sequence.explanation.noExplanation}">
      There is no explanation.
    </div>
  </div>
  <div th:if="${displaysAll != true}">
    <div th:each="i : ${#numbers.sequence(0,T(Math).min(responses.size(), 3))}">
      <!--      TODO ...-->
      <g:set var="theResponse" value="${responses.get(i)}"/>
      <g:set var="explanation" value="${theResponse?.explanation}"/>
      <g:if test="${theResponse?.explanation}">
        <g:render template="/assignment/player/explanation-elaastic"
                  model="[theResponse: theResponse, explanation: theResponse?.explanation]"/>
      </g:if>

    </div>


    <div th:if="${!explanationCount && !badResponses}"
         class="ui warning message"
         th:text="#{player.sequence.explanation.noExplanation}">
      There is no explanation.
    </div>
    <div th:if="${(explanationCount || badResponses) && (explanationCount > 3 || badResponses)}">
<!--      TODO Migrate onclick-->
      <button type="button"
              class="ui button"
              onclick="$('#all_explanations_for_${sequence.id}').modal('show');">
        ${message(code: "player.sequence.explanation.all.button")}
      </button>
    </div>

    <div id="all_explanations_for_${sequence.id}"
         class="ui modal"
         tabindex="-1" role="dialog"
         aria-hidden="true">

      <div class="header">
        ${message(code: "player.sequence.explanation.all")}
      </div>

      <div class="scrolling content">

        <g:if test="${badResponses}">
          <div class="ui styled fluid accordion" id="accordion">
            <div class="active title">
              <i class="dropdown icon"></i>
              <g:set var="responsesChoice"
                     value="${responses.size() > 0 ? responses.get(0).choiceListSpecification : null}"/>
              ${message(code: "player.sequence.users.responses")}: ${responsesChoice}<strong>-</strong>
              ${message(code: "player.sequence.user.score", args: [100])}<strong>-</strong>
              ${message(code: "player.sequence.responseCount")}: ${responses.size()}
            </div>


            <div class="active content">
              <p class="panel-body">
                <g:render template="/assignment/player/ExplanationList-elaastic"
                          model="[responses: responses, sequence: sequence, displaysAll: true]"/>
              </p>
            </div>


            <g:each in="${badResponses}" var="answerMap" status="i">
              <g:each in="${answerMap.value}" var="explanationList" status="j">
                <div class="title">
                  <i class="dropdown icon"></i>
                  ${message(code: "player.sequence.users.responses")}: ${explanationList.key}<strong>-</strong>
                  ${message(code: "player.sequence.user.score", args: [answerMap.key])}<strong>-</strong>
                  ${message(code: "player.sequence.responseCount")}: ${explanationList.value.size()}
                </div>

                <div class="content">
                  <p class="panel-body">
                    <g:render template="/assignment/player/ExplanationList-elaastic"
                              model="[responses: explanationList.value, sequence: sequence, displaysAll: true]"/>
                  </p>
                </div>
              </g:each>
            </g:each>
          </div>
          <r:script>
            $('#accordion')
            .accordion()
            ;
          </r:script>
        </g:if>
        <g:else>
          <g:render template="/assignment/player/ExplanationList-elaastic"
                    model="[responses: responses, sequence: sequence, displaysAll: true]"/>
        </g:else>
      </div>

      <div class="actions">
        <div class="ui cancel button">${message(code: "player.sequence.explanation.close.button")}</div>
      </div>

    </div>

  </div>
</div>
