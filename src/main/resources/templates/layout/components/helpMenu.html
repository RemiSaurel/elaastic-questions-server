<!--
  ~ Elaastic - formative assessment system
  ~ Copyright (C) 2019. University Toulouse 1 Capitole, University Toulouse 3 Paul Sabatier
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later ve
rsion.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->


<div th:fragment="helpMenu()"
     xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html"
     xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

  <div id="help-menu-dropdown"
       class="ui dropdown item help-menu"
       th:attr="data-tooltip=#{common.Help}"
       data-tooltip="Help"
       data-position="right center"
       data-inverted="">
    <i class="question circle icon"></i>

    <div class="ui vertical menu">
      <div class="header" style="text-align: center; text-overflow: ellipsis; overflow: hidden;">
        <span th:text="#{common.Help}">Help</span>
      </div>

      <a href="#" class="item" th:onclick="startContextualOb(true)">
        <i class="clock outline icon"></i>
        <span th:text="#{common.quick-start}">Quick start</span>
      </a>

      <a th:href="#{common.online-help.url}"
         target="_blank"
         class="item">
        <i class="question circle outline icon"></i>
        <span th:text="#{common.online-help}">Online help</span>
      </a>


    </div>
  </div>


  <script th:inline="javascript">
    $(document)
            .ready(function () {

              // Initialize dropdown
              $('#help-menu-dropdown').dropdown()
              startContextualOb(false)
            })

    obCoursePage = function() {
      introJs().setOptions({
        steps: [
          {
            title: [[#{onboarding.introduction.title}]],
            intro: [[#{onboarding.introduction.content}]]
          },
          {
            element: document.querySelector('.ob-course-creation-1'),
            intro: [[#{onboarding.content.course_creation.1}]]
          },
          {
            element: document.querySelector('.ob-course-creation-2'),
            intro: [[#{onboarding.content.course_creation.2}]]
          },
          {
            element: document.querySelector('.ob-course-creation-3'),
            intro: [[#{onboarding.content.course_creation.3}]]
          }
        ]
      }).onchange(function (targetElement) {
        if (targetElement.classList.contains('ob-course-creation-3')) {
          fetch('/userAccount/updateOnboardingChapter/course_page')
        }
      }).start()
    }

    obCourseCreationPage = function() {
      introJs().setOptions({
        steps: [
          {
            element: document.querySelector('.ob-course-creation-4'),
            intro: [[#{onboarding.content.course_creation.4}]]
          },
          {
            element: document.querySelector('.ob-course-creation-5'),
            intro: [[#{onboarding.content.course_creation.5}]]
          }
        ]
      }).onchange(function (targetElement) {
        if (targetElement.classList.contains('ob-course-creation-5')) {
          fetch('/userAccount/updateOnboardingChapter/course_creation_page')
        }
      }).start();
    }

    obSubjectPage = function(){
      introJs().setOptions({
        steps: [
          {
            element: document.querySelector('.ob-subject-creation-1'),
            intro: [[#{onboarding.content.subject_creation.1}]]
          },
          {
            element: document.querySelector('.ob-subject-creation-2'),
            intro: [[#{onboarding.content.subject_creation.2}]]
          },
          {
            element: document.querySelector('.ob-subject-creation-3'),
            intro: [[#{onboarding.content.subject_creation.3}]]
          }
        ]
      }).onchange(function (targetElement) {
        if (targetElement.classList.contains('ob-subject-creation-3')) {
          fetch('/userAccount/updateOnboardingChapter/subject_page')
        }
      }).start()
    }

    obSubjectCreationPage = function(){
      introJs().setOptions({
        steps: [
          {
            element: document.querySelector('.ob-subject-creation-4'),
            intro: [[#{onboarding.content.subject_creation.4}]]
          },
          {
            element: document.querySelector('.ob-subject-creation-5'),
            intro: [[#{onboarding.content.subject_creation.5}]]
          },
          {
            element: document.querySelector('.ob-subject-creation-6'),
            intro: [[#{onboarding.content.subject_creation.6}]]
          }
        ]
      }).onchange(function (targetElement) {
        if (targetElement.classList.contains('ob-subject-creation-6')) {
          fetch('/userAccount/updateOnboardingChapter/subject_creation_page')
        }
      }).start()
    }

    obSubjectEditionPage = function(){
      introJs().setOptions({
        steps: [
          {
            element: document.querySelector('.ob-question-creation-1'),
            intro: [[#{onboarding.content.question_creation.1}]]
          },
          {
            element: document.querySelector('.ob-question-creation-2'),
            intro: [[#{onboarding.content.question_creation.2}]]
          },
          {
            element: document.querySelector('.ob-question-creation-15'),
            intro: [[#{onboarding.content.question_creation.15}]]
          },
          {
            element: document.querySelector('.ob-question-creation-16'),
            intro: [[#{onboarding.content.question_creation.16}]]
          },
          {
            element: document.querySelector('.ob-question-creation-17'),
            intro: [[#{onboarding.content.question_creation.17}]]
          },
          {
            element: document.querySelector('.ob-question-creation-18'),
            intro: [[#{onboarding.content.question_creation.18}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-1'),
            intro: [[#{onboarding.content.assignment_creation.1}]]
          },
          {
            intro: [[#{onboarding.content.assignment_creation.2}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-13'),
            intro: [[#{onboarding.content.assignment_creation.9}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-14'),
            intro: [[#{onboarding.content.assignment_creation.10}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-15'),
            intro: [[#{onboarding.content.assignment_creation.11}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-16'),
            intro: [[#{onboarding.content.assignment_creation.12}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-7'),
            intro: [[#{onboarding.content.assignment_creation.3}]]
          }
        ].filter(function(obj) { return $(obj.element).length; })
      }).onchange(function (targetElement) {
        if (targetElement.classList.contains('ob-assignment-creation-7')) {
          fetch('/userAccount/updateOnboardingChapter/subject_edition_page')
        }
      }).onbeforechange(function (targetElement) {
        if(targetElement){
          if (targetElement.classList.contains('ob-assignment-creation-1')) {
            document.getElementsByClassName('ob-assignment-creation-1')[0].click()
          }
          if (targetElement.classList.contains('ob-question-creation-1')
                  || targetElement.classList.contains('ob-question-creation-2')
                          || targetElement.classList.contains('ob-question-creation-18')) {
            document.getElementsByClassName('ob-question-creation-1')[0].click()
          }
        }

      }).start()
    }

    obQuestionCreationPage = function(){
      introJs().setOptions({
        steps: [
          {
            element: document.querySelector('.ob-question-creation-3'),
            intro: [[#{onboarding.content.question_creation.3}]]
          },
          {
            element: document.querySelector('.ob-question-creation-4'),
            intro: [[#{onboarding.content.question_creation.4}]]
          },
          {
            element: document.querySelector('.ob-question-creation-5'),
            intro: [[#{onboarding.content.question_creation.5}]]
          },
          {
            element: document.querySelector('.ob-question-creation-6'),
            intro: [[#{onboarding.content.question_creation.6}]]
          },
          {
            element: document.querySelector('.ob-question-creation-7'),
            intro: [[#{onboarding.content.question_creation.7}]]
          },
          {
            element: document.querySelector('.ob-question-creation-8'),
            intro: [[#{onboarding.content.question_creation.8}]]
          },
          {
            element: document.querySelector('.ob-question-creation-9'),
            intro: [[#{onboarding.content.question_creation.9}]]
          },
          {
            element: document.querySelector('.ob-question-creation-10'),
            intro: [[#{onboarding.content.question_creation.10}]]
          },
          {
            element: document.querySelector('.ob-question-creation-14'),
            intro: [[#{onboarding.content.question_creation.14}]]
          }
        ]
      }).onchange(function (targetElement) {
        if (targetElement.classList.contains('ob-question-creation-14')) {
          fetch('/userAccount/updateOnboardingChapter/question_creation_page')
        }
      }).start()
    }

    obAssignmentCreationPage = function(){
      introJs().setOptions({
        steps: [
          {
            element: document.querySelector('.ob-assignment-creation-8'),
            intro: [[#{onboarding.content.assignment_creation.4}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-9'),
            intro: [[#{onboarding.content.assignment_creation.5}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-10'),
            intro: [[#{onboarding.content.assignment_creation.6}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-11'),
            intro: [[#{onboarding.content.assignment_creation.7}]]
          },
          {
            element: document.querySelector('.ob-assignment-creation-12'),
            intro: [[#{onboarding.content.assignment_creation.8}]]

          },
        ]
      }).onchange(function (targetElement) {
        if (targetElement.classList.contains('ob-assignment-creation-12')) {
          fetch('/userAccount/updateOnboardingChapter/assignment_creation_page')
        }
      }).start();
    }

    obPlayerPage = function(){
      introJs().setOptions({
        steps: [
          {
            intro: [[#{onboarding.content.prepare_sequence.1}]]
          },
          {
            element: document.querySelector('.ob-start-sequence-2'),
            intro: [[#{onboarding.content.prepare_sequence.2}]]
          },
          {
            element: document.querySelector('.ob-start-sequence-3'),
            intro: [[#{onboarding.content.prepare_sequence.3}]]
          },
          {
            element: document.querySelector('.ob-start-sequence-4'),
            intro: [[#{onboarding.content.prepare_sequence.4}]]
          },
          {
            element: document.querySelector('.ob-play-sequence-1'),
            intro: [[#{onboarding.content.play_sequence.1}]]
          },
          {
            element: document.querySelector('.ob-play-sequence-2'),
            intro: [[#{onboarding.content.play_sequence.2}]]
          },
          {
            element: document.querySelector('.ob-play-sequence-3'),
            intro: [[#{onboarding.content.play_sequence.3}]]
          },
          {
            element: document.querySelector('.ob-play-sequence-4'),
            intro: [[#{onboarding.content.play_sequence.4}]]
          }].filter(function(obj) { return $(obj.element).length; })
      }).onchange(function (targetElement) {
        if (targetElement.classList.contains('ob-start-sequence-5') || targetElement.classList.contains('ob-play-sequence-4')) {
          fetch('/userAccount/updateOnboardingChapter/player_page')
        }
      }).start();
    }

    startContextualOb = function(manuallyActivated){
      if ((manuallyActivated || [[${!user.onboardingState.course_page}]]) && document.getElementsByClassName('ob-course-creation-2').length !== 0) {
        obCoursePage()
      }
      if ((manuallyActivated || [[${!user.onboardingState.course_creation_page}]]) && document.getElementsByClassName('ob-course-creation-4').length !== 0) {
        obCourseCreationPage()
      }
      if ((manuallyActivated || [[${!user.onboardingState.subject_page}]]) && document.getElementsByClassName('ob-subject-creation-2').length !== 0) {
        obSubjectPage()
      }
      if ((manuallyActivated || [[${!user.onboardingState.subject_creation_page}]]) && document.getElementsByClassName('ob-subject-creation-4').length !== 0) {
        obSubjectCreationPage()
      }
      if ((manuallyActivated || [[${!user.onboardingState.subject_edition_page}]]) && document.getElementsByClassName('ob-question-creation-1').length !== 0) {
        obSubjectEditionPage()
      }
      if ((manuallyActivated || [[${!user.onboardingState.question_creation_page}]]) && document.getElementsByClassName('ob-question-creation-3').length !== 0) {
        obQuestionCreationPage()
      }
      if ((manuallyActivated || [[${!user.onboardingState.assignment_creation_page}]]) && document.getElementsByClassName('ob-assignment-creation-8').length !== 0) {
        obAssignmentCreationPage()
      }
      if ((manuallyActivated || [[${!user.onboardingState.player_page}]]) && document.getElementsByClassName('ob-start-sequence-2').length !== 0) {
        obPlayerPage()
      }
    }
  </script>
</div>
